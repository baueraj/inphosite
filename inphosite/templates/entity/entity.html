<%! import urllib %>
<%inherit file="/base-tree.html" />

## Header
<%def name="title()">${parent.title()} - Entity - ${c.entity.label}</%def>
<%def name="head_title()">${c.entity.label}</%def>
## Sidebar
<%def name="sidebar()">
${parent.sidebar()}
<br />
${parent.draw()}</%def>

<h1>${c.entity.label}</h1>

<%def name="printList(ideas, attr, statistical=False, alt_title='', tax_class='')">
<% title = alt_title if alt_title else h.titlecase(attr.replace('_', ' ')) %>
<div id="${attr}">
%if not ideas:
<h3 class="empty">${title}</h3>
%if tax_class:
<p class="bottom">${c.entity.label} is not <em>yet</em> classified in the taxonomy. Please submit <a href="${h.url(controller='idea', action='edit', id=c.entity.ID)}">evaluations</a> to help improve the InPhO.</p>
%endif
%else:
<h3>${title} <span class="toggle on" onclick="toggleList('#${attr}')">&nbsp;</span> </h3>
%if statistical:
<p class="bottom">Generated by <i>statistical measures</i></p>
%endif
<ol>
%for idea in ideas:
%if tax_class:
<div>
${printEntity(idea[0], group=True)}
%if idea[0] != idea[1]:
${printEntity(idea[1], cls=tax_class, group=True, srch_id=idea[0].ID)}
%endif
</div>
%else:
${printEntity(idea)}
%endif
%endfor
</ol>
%endif
</div> <!-- ${attr} -->

</%def>

<%def name="printEntity(cons, cls='', group=False, srch_id=None, evaluation_type='Idea')">
<%
c.entID += 1

gen, rel = c.evaluations[cons.ID] 

search = "search(this, %d, %d)" % (c.entity.ID, cons.ID)

if c.uid:
    onchange_rel = "onChange=\"thisFunc($(this).parent().parent(), 'relatedness')\""
    onchange_gen = "onChange=\"thisFunc($(this).parent().parent(), 'generality')\""
else:
    onchange_rel = ''
    onchange_gen = ''
    
%>

    %if group:
    <% srch_id = srch_id or cons.ID %>
    <li onClick="search($(this).parent().get(0), ${srch_id}, ${c.entity.ID})" class="idea ${cls}" id="${c.entID}">\
    %else:
    <li onClick="search(this, ${c.entity.ID}, ${cons.ID})" class="idea ${cls}" id="${c.entID}">\
    %endif
    %if cons not in c.entity.nodes and cons != c.entity:
    <a href="${cons.url()}" class="sep">
    <img src="/img/inpho.png" /></a>\
    %endif

    %if (rel > -1) and (gen > -1):
    <img class='loading' src="/img/check.gif" />
    <script>incrEvals();</script>
    %else:
    <img class='loading' src="/img/empty.gif" />
    %endif

    %if cons.sep_dir:
    <a href="http://plato.stanford.edu/entries/${cons.sep_dir}/" class="icons"
    target="_blank">
    <img src="/img/sepmanicon.png" /></a>\
    %endif
    <a class="concept" href="#moreInfo">${cons.label}</a>\

%if evaluation_type == 'Idea' and (not group or (group and cls != '')):
<form>
    <!-- <a href="#" onClick="flagIdea(this.parent().parent(), ${cons.ID})">
        <img class='delete' id="delete" title="Click if this is not a philosophical idea" src="/img/delete.png" />
    </a> -->
    %if group:
    <input type="hidden" name="ante_id" value="${c.entity.ID}" />
    <input type="hidden" name="cons_id" value="${srch_id}" />
    %else:
    <input type="hidden" name="ante_id" value="${c.entity.ID}" />
    <input type="hidden" name="cons_id" value="${cons.ID}" />
    %endif
    
    <div class="reltext" id="reltext${cons.ID}"><strong>Drag slider to set relatedness:</strong></div>
    <div id="slider${cons.ID}" class="slider"></div>
    <script>
    //$(alert($("#${c.entID} form")));
    $(initSlider($("#${c.entID} form .slider"), ${rel}, ${'true' if c.uid else 'false'}));
    </script>
    <div><small>unrelated</small><small style="float: right;">highly related</small></div>
    <input type="hidden" class="relatedness" name="relatedness" id="rel${cons.ID}" value="${rel}" />

    %if gen > -1:
    <div class="generality" style="">
    %else:
    <div class="generality" style="display: none;">
    %endif
    <input type="radio" name="generality" value="0" ${onchange_gen} \
%if gen == 0:
checked\
%endif    
 />\
        <em>more specific</em> than ${c.entity.label}<br />
    <input type="radio" name="generality" value="1" ${onchange_gen} \
%if gen == 1:
checked\
%endif    
 />\
        <em>more general</em> than ${c.entity.label}<br />
    <input type="radio" name="generality" value="2" ${onchange_gen} \
%if gen == 2:
checked\
%endif    
 />\
        <em>as general</em> as ${c.entity.label}<br />
    <input type="radio" name="generality" value="3" ${onchange_gen} \
%if gen == 3:
checked\
%endif    
 />\
        <em>incomparable</em> to ${c.entity.label}<br />
    </div>

%if request.environ.get('REMOTE_USER'):
    <input name="reset" type="button" value="Reset" onClick="resetEvaluation($(this).parent())" />
%else:
    <input name="submit" type="button" value="Submit" onClick="submitEvals($(this).parent())" style="display: none;" />
%endif
</form>

%endif
    
    </li>

</%def>


<%def name="printAdminPanel(attrs)">
    <div id="admin">
    <h3>Admin
    <span class="toggle on" onclick="toggleList('#admin')">&nbsp;</span>
    </h3>
      <ul>
        %for attr in attrs:
        ${printAttr(attr)}
        %endfor
      </ul>
    </div>
</%def>


<%def name="printAttr(attr)">

  ## Immutable attributes
  ## ID (immutable; for Idea, Thinker, Journal, SOT, Work)
  %if (attr == "id"):
    <li class="idea">
      <span id="id_edit" class="sep" style="visibility: hidden">
        <img src="/img/pencil.png"/>
      </span>
      <b>ID:</b>
      <span id="id_field"> ${c.entity.ID} </span>
    </li>
  ## Type (immutable; for Idea, Thinker, Journal, SOT, Work)
  %elif (attr == "type"):
    <li class="idea">
      <span id="type_edit" class="sep" style="visibility: hidden">
        <img src="/img/pencil.png"/>
      </span>
      <b>Type:</b>
      <span id="type_field"> ${type(c.entity).__name__} </span>
    </li>
  ## Label (immutable; for Idea, Thinker, Journal, SOT, Work)
  %elif (attr == "label"):
    <li class="idea">
      <span id="label_edit" class="sep" style="visibility: hidden">
        <img src="/img/pencil.png"/>
      </span>
      <b>Label:</b>
      <span id="label_field"> ${c.entity.label} </span>
    </li>
  ## In-degree (immutable; for Idea)
  %elif (attr == "in-degree"):
    <li class="idea">
      <span id="in-degree_edit" class="sep" style="visibility: hidden">
        <img src="/img/pencil.png"/>
      </span>
      <b>In-degree:</b>
      <span id="in-degree_field"> ${c.entity.in_degree} </span>
    </li>
  ## Out-degree (immutable; for Idea)
  %elif (attr == "out-degree"):
    <li class="idea">
      <span id="out-degree_edit" class="sep" style="visibility: hidden">
        <img src="/img/pencil.png"/>
      </span>
      <b>Out-degree:</b>
      <span id="out-degree_field"> ${c.entity.in_degree} </span>
    </li>
  ## Entropy (immutable; for Idea)
  %elif (attr == "entropy"):
    <li class="idea">
      <span id="entropy_edit" class="sep" style="visibility: hidden">
        <img src="/img/pencil.png"/>
      </span>
      <b>Entropy:</b>
      <span id="entropy_field"> ${c.entity.entropy} </span>
    </li>

  ## Mutable via textbox
  ## Sep_dir (mutable; for Idea, Thinker, Journal, SOT, Work)
  %elif (attr == "sep_dir"):
    <li class="idea">
      <span id="sep_dir_edit" class="sep" onclick="edit('sep_dir', '${c.entity.url()}')">
        <img src="/img/pencil.png"/>
      </span>
      <b>Sep_dir:</b>
      <span id="sep_dir_field">
        <span id="current_sep_dir" onclick="edit('sep_dir', '${c.entity.url()}')">
          ${c.entity.sep_dir}
        </span>
      </span>
    </li>
  ## Searchstring (mutable; for Idea, Thinker)
  %elif (attr == "searchstring"):
    <li class="idea">
      <span id="searchstring_edit" class="sep" onclick="edit('searchstring', '${c.entity.url()}')">
        <img src="/img/pencil.png"/>
      </span>
      <b>Searchstring:</b>
      <span id="searchstring_field">
        <span id="current_searchstring" onclick="edit('searchstring', '${c.entity.url()}')">
          ${c.entity.searchstring}
        </span>
      </span>
    </li>
  ## Wiki (mutable; for Thinker)
  %elif (attr == "wiki"):
    <li class="idea">
      <span id="wiki_edit" class="sep" onclick="edit('wiki', '${c.entity.url()}')">
        <img src="/img/pencil.png"/>
      </span>
      <b>Wiki:</b>
      <span id="wiki_field">
        <span id="current_wiki" onclick="edit('wiki', '${c.entity.url()}')">
          ${c.entity.wiki}
        </span>
      </span>
    </li>
  ## Birthday (mutable; for Thinker)
  %elif (attr == "birthday"):
    <li class="idea">
      <span id="birth_edit" class="sep" onclick="edit('birth', '${c.entity.url()}')">
        <img src="/img/pencil.png"/>
      </span>
      <b>Birthday:</b>
      <span id="birth_field">
        <span id="current_birth" onclick="edit('birth', '${c.entity.url()}')">
          ${c.entity.birth_string}
        </span>
        <input type="text" style="visibility: hidden" id="birth_year" value="${h.bc(c.entity.birth_year)[1]}" size="4" onKeyDown="Javascript: if (event.keyCode == 13) submit('birth', '${c.entity.url()}')">
        <input type="text" style="visibility: hidden" id="birth_month" value="${c.entity.birth_month}" size="8" onKeyDown="Javascript: if (event.keyCode == 13) submit('birth', '${c.entity.url()}')">
        <input type="text" style="visibility: hidden" id="birth_day" value="${c.entity.birth_day}" size="2" onKeyDown="Javascript: if (event.keyCode == 13) submit('birth', '${c.entity.url()}')">
        <select id="birth_era" style="visibility: hidden" onclick="submit('birth', '${c.entity.url()}')">
          %if h.bc(c.entity.birth_year)[0] == "BCE":
          <option selected="selected" value="BCE"> BCE </option>
          <option value="CE"> CE </option>
          %elif h.bc(c.entity.birth_year)[0] == "CE":
          <option value="BCE"> BCE </option>
          <option selected="selected" value="CE"> CE </option>
          %endif
        </select>
      </span>
    </li>
  ## Deathday (mutable; for Thinker)
  %elif (attr == "deathday"):
    <li class="idea">
      <span id="deathday_edit" class="sep" onclick="edit('deathday', '${c.entity.url()}')">
        <img src="/img/pencil.png"/>
      </span>
      <b>Deathday:</b>
      <span id="deathday_field">
        <span id="current_deathday" onclick="edit('deathday', '${c.entity.url()}')">
          ${c.entity.death_string}
        </span>
      </span>
    </li>
  ## Website (mutable; for Journal)
  %elif (attr == "URL"):
    <li class="idea">
      <span id="URL_edit" class="sep" onclick="edit('URL', '${c.entity.url()}')">
        <img src="/img/pencil.png"/>
      </span>
      <b>URL:</b>
      <span id="URL_field">
        <span id="current_URL" onclick="edit('URL', '${c.entity.url()}')">
          ${c.entity.URL}
        </span>
      </span>
      <a id="test_URL" href="${c.entity.URL}">(test)</a></dt>
    </li>
  ## Last_accessed (mutable; for Journal)
  %elif (attr == "last_accessed"):
    <li class="idea">
      <span id="last_accessed_edit" class="sep" onclick="edit('last_accessed', '${c.entity.url()}')">
        <img src="/img/pencil.png"/>
      </span>
      <b>Last Accessed:</b>
      <span id="last_accessed_field">
        <span id="current_last_accessed" onclick="edit('last_accessed', '${c.entity.url()}')">
          ${c.entity.last_accessed}
        </span>
      </span>
    </li>
  ## Language (mutable; for Journal)
  %elif (attr == "language"):
    <li class="idea">
      <span id="language_edit" class="sep" onclick="edit('language', '${c.entity.url()}')">
        <img src="/img/pencil.png"/>
      </span>
      <b>Language:</b>
      <span id="language_field">
        <span id="current_language" onclick="edit('language', '${c.entity.url()}')">
          ${c.entity.language}
        </span>
      </span>
    </li>
  ## ISSN (mutable; for Journal)
  %elif (attr == "ISSN"):
    <li class="idea">
      <span id="ISSN_edit" class="sep" onclick="edit('ISSN', '${c.entity.url()}')">
        <img src="/img/pencil.png"/>
      </span>
      <b>ISSN:</b>
      <span id="ISSN_field">
        <span id="current_ISSN" onclick="edit('ISSN', '${c.entity.url()}')">
          ${c.entity.ISSN}
        </span>
      </span>
    </li>

  ## Mutable via dropdown menu
  ## Open Access (mutable; for Journal)
  %elif (attr == "openAccess"):
    <li class="idea">
      <span id="openAccess_edit" class="sep" onclick="edit('openAccess', '${c.entity.url()}')">
        <img src="/img/pencil.png"/>
      </span>
      <b>OpenAccess:</b>
      <span id="openAccess_field">
        <span id="current_openAccess" onclick="edit('openAccess', '${c.entity.url()}')">
          %if c.entity.openAccess == 0:
            Closed
          %elif c.entity.openAccess == 1:
            Open
          %endif
        </span>
      </span>
    </li>
  ## Active (mutable; for Journal)
  %elif (attr == "active"):
    <li class="idea">
      <span id="active_edit" class="sep" onclick="edit('active', '${c.entity.url()}')">
        <img src="/img/pencil.png"/>
      </span>
      <b>Active:</b>
      <span id="active_field">
        <span id="current_active" onclick="edit('active', '${c.entity.url()}')">
          %if c.entity.active == 0:
            Inactive
          %elif c.entity.active == 1:
            Active
          %endif
        </span>
      </span>
    </li>
  ## Student (mutable; for Journal)
  %elif (attr == "student"):
    <li class="idea">
      <span id="student_edit" class="sep" onclick="edit('student', '${c.entity.url()}')">
        <img src="/img/pencil.png"/>
      </span>
      <b>Student:</b>
      <span id="student_field">
        <span id="current_student" onclick="edit('student', '${c.entity.url()}')">
          %if c.entity.student == 0:
            Nonstudent
          %elif c.entity.student == 1:
            Student
          %endif
        </span>
      </span>
    </li>


  ## Searchpattern(s) (mutable; for Idea, Thinker)
  %elif (attr == "searchpatterns"):
    %for i,searchpattern in enumerate(c.entity.searchpatterns):
      <li class="idea">
        <span id="searchpattern${i}_edit" class="sep" onclick="edit('searchpattern${i}', '${c.entity.url()}')">
          <img src="/img/pencil.png"/>
        </span>
        <span id="searchpattern${i}_field">
          <span id="current_searchpattern${i}" onclick="edit('searchpattern${i}', '${c.entity.url()}')">
            ${searchpattern}
          </span>
        </span>
      </li>
    %endfor
  ## Abbreviation(s) (mutable; for Journal)
  %elif (attr == "abbreviations"):
    %for i,abbreviation in enumerate(c.entity.abbreviations):
      <li class="idea">
        <span id="abbreviation${i}_edit" class="sep" onclick="edit('abbreviation${i}', '${c.entity.url()}')">
          <img src="/img/pencil.png"/>
        </span>
        <span id="abbreviation${i}_field">
          <span id="current_abbreviation${i}" onclick="edit('searchpattern${i}', '${c.entity.url()}')">
            ${abbreviation}
          </span>
        </span>
      </li>
    %endfor
  ## Quer[y|ies] (mutable; for Journal)
  %elif (attr == "queries"):
    %for i,query in enumerate(c.entity.queries):
      <li class="idea">
        <span id="query${i}_edit" class="sep" onclick="edit('query${i}', '${c.entity.url()}')">
          <img src="/img/pencil.png"/>
        </span>
        <span id="query${i}_field">
          <span id="current_query${i}" onclick="edit('query${i}', '${c.entity.url()}')">
            ${query}
          </span>
        </span>
      </li>
    %endfor
  %endif


</%def>
