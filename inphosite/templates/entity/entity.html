<%! import urllib %>
<%inherit file="/base-tree.html" />
<%namespace name="bootstrap" file="/bootstrap-form.html" />

## Header
<%def name="title()">${parent.title()} - Entity - ${c.entity.label}</%def>
<%def name="head_title()">${c.entity.label}</%def>
## Sidebar
<%def name="sidebar()">
${parent.sidebar()}
<br />
${parent.draw()}</%def>

<h1>${c.entity.label}</h1>

<%def name="printList(attr, alt_title='', limit=10, statistical=False)">
%if getattr(c.entity, attr)[:limit]:
<% title = alt_title if alt_title else h.titlecase(attr.replace('_', ' ')) %>
<div class="terms span3" id="${attr}" data-source="/idea/${c.entity.ID}/${attr}.json">
<h3>${title}\
%if statistical:
<a href="#" rel="tooltip" title="List generated by statistical methods." class="pull-right"><i class="icon-cog"></i></a>\
%endif
</h3>
<ol class="unstyled">
%for idea in getattr(c.entity, attr)[:limit]:
<li><a onClick="inpho.tabnav.appendTab('tabnav', 'i${idea.ID}', '${h.titlecase(idea.label).replace("'", r"\'")}', '/idea/${c.entity.ID}/panel/${idea.ID}')" href="#i${idea.ID}" data-toggle="tab">${h.titlecase(idea.label)}</a></li>
%endfor
## TODO: Investigate this to make dynamically loaded queries use "len"
%if len(getattr(c.entity, attr)[:]) > limit:
<li class="more"><a onClick="inpho.entity.showMore('${attr}', ${c.entity.ID}, ${limit}, ${limit})">Show more&#133; (${len(getattr(c.entity, attr)[:]) - limit})</a></li>
%endif
</ol>
</div> <!-- ${attr} -->
%endif
</%def>

<%def name="printAdminPanel(attrs)">
<form class="form-horizontal" method="GET" action="${c.entity.url()}">
  <fieldset>
    <legend>Admin</legend>
    %for attr in attrs:
    ${printAttr(attr)}
    %endfor
  </fieldset>
  <fieldset>
    <input type="hidden" name="_method" value="PUT" />
    <input type="hidden" name="redirect" value="1" />
    <input type="submit" value="Submit" />
    <input type="reset" value="Reset" />
  </fieldset>
</form>
</%def>

<%def name="printAttr(attr)"> 
  %if (attr in ["last_accessed", "sep_dir", "language", "ISSN", "searchstring", "wiki"]):
  ${bootstrap.textbox(attr, c.entity.url(), getattr(c.entity, attr, ''))}
  %elif attr == "URL":
  ${bootstrap.url_textbox(attr, c.entity.url(), getattr(c.entity, attr, ''), c.entity.google_url)}
  %elif (attr in ["ID", "label", "in_degree", "out_degree", "entropy", "type"]):
  ${bootstrap.disabled_textbox(attr, getattr(c.entity, attr, ''))}
  %elif attr in ["openAccess", "active", "student"]:
  ${bootstrap.checkbox(attr, c.entity.url(), h.titlecase(attr), getattr(c.entity, attr, False))}
  %elif (attr in ["searchpatterns", "abbrs", "queries"]):
  ${bootstrap.list(attr, c.entity.url(action=attr), c.entity.searchpatterns)}
    <%doc>
    ## Birth Date(s) (mutable; for Idea, Thinker)
    %elif (attr == "birth"):
    <ul>
      %for i,birth_date in enumerate(c.entity.birth):
      <li class="idea" id="birth_date${i}">
        <span id="birth_date${i}_edit" class="sep" onclick="inpho.admin.removesp('birth_date${i}','${c.entity.url(action='date', id2='1')}')">
          <img src="/img/delete.png" width=18 height=18 />
        </span>
        <span id="birth_date${i}_field">
          ${birth_date}
        </span>
      </li>
      %endfor
    </ul>
    </%doc>
  %elif (attr == "birth"):
  ${dateControl(attr, 1)}
  %elif (attr == "death"):
  ${dateControl(attr, 2)}
  %endif
</%def>

<%def name="dateControl(attr, relation_id)">
<form class="form-inline dateControl" name="date" action="/entity/${c.entity.ID}/date/${relation_id}" method="POST" id="${attr}_form">
  <fieldset>
    <legend>${attr.capitalize()} Date</legend>
    <br />
    <select class="input-medium" name="month" id="${attr}_month">
      <option value="0">Month</option>
      <option value="1">January</option>
      <option value="2">February</option>
      <option value="3">March</option>
      <option value="4">April</option>
      <option value="5">May</option>
      <option value="6">June</option>
      <option value="7">July</option>
      <option value="8">August</option>
      <option value="9">September</option>
      <option value="10">October</option>
      <option value="11">November</option>
      <option value="12">December</option>
    </select>
    
    <select class="span1" name="day" id="${attr}_day">
      <option value="0">Day</option>
      <option>1</option>
      <option>2</option>
      <option>3</option>
      <option>4</option>
      <option>5</option>
      <option>6</option>
      <option>7</option>
      <option>8</option>
      <option>9</option>
      <option>10</option>
      <option>11</option>
      <option>12</option>
      <option>13</option>
      <option>14</option>
      <option>15</option>
      <option>16</option>
      <option>17</option>
      <option>18</option>
      <option>19</option>
      <option>20</option>
      <option>21</option>
      <option>22</option>
      <option>23</option>
      <option>24</option>
      <option>25</option>
      <option>26</option>
      <option>27</option>
      <option>28</option>
      <option>29</option>
      <option>30</option>
      <option>31</option>
    </select>

    <input class="input-small" type="text" name="year" size="4" maxlength="4" placeholder="Year" id="${attr}_year" />
    
    <select class="input-medium" name="era" id="${attr}_era">
      <option>Era</option>
      <option value="bce">B.C.E. (B.C.)</option>
      <option value="ce">C.E. (A.D.)</option>
    </select>

    <label class="checkbox pull-right">
      <input class="checkbox" type="checkbox" name="is_date_range" value="is_date_range" id="${attr}_is_date_range" />
      Date Range?
    </label>

    <br />
    
    <div id="${attr}_date_range" class="date_range" style="display: none; margin-top: 10px;">
      <select class="input-medium" name="month_end">
	<option value="0">Month</option>
	<option value="1">January</option>
	<option value="2">February</option>
	<option value="3">March</option>
	<option value="4">April</option>
	<option value="5">May</option>
	<option value="6">June</option>
	<option value="7">July</option>
	<option value="8">August</option>
	<option value="9">September</option>
	<option value="10">October</option>
	<option value="11">November</option>
	<option value="12">December</option>
      </select>
      
      <select class="span1" name="day_end">
	<option value="0">Day</option>
	<option>1</option>
	<option>2</option>
	<option>3</option>
	<option>4</option>
	<option>5</option>
	<option>6</option>
	<option>7</option>
	<option>8</option>
	<option>9</option>
	<option>10</option>
	<option>11</option>
	<option>12</option>
	<option>13</option>
	<option>14</option>
	<option>15</option>
	<option>16</option>
	<option>17</option>
	<option>18</option>
	<option>19</option>
	<option>20</option>
	<option>21</option>
	<option>22</option>
	<option>23</option>
	<option>24</option>
	<option>25</option>
	<option>26</option>
	<option>27</option>
	<option>28</option>
	<option>29</option>
	<option>30</option>
	<option>31</option>
      </select>
      
      <input class="input-small" type="text" name="year_end" size="4" maxlength="4" value="Year" id="${attr}_year_end" />
      
      <select class="input-medium" name="era_end" id="${attr}_era_end">
	<option>Era</option>
	<option value="bce">B.C.E. (B.C.)</option>
	<option value="ce">C.E. (A.D.)</option>
      </select>
    </div>
    
    <br />

    <button class="btn btn-primary" type="submit" id="${attr}_submit">Submit</button>
    <button class="btn" type="reset" id="${attr}_reset" value="Reset">Reset</button>
  </fieldset>
</form>

<hr />

<script>
  <!-- script handling form expansion/collapse for date ranges-->
  $("#${attr}_is_date_range").click(
  function() {
  if ($("#${attr}_date_range").is(":hidden")) {
  $("#${attr}_date_range").slideDown();
  }   
  else {
  $("#${attr}_date_range").slideUp();          
  var month = $("#${attr}_month").val();
  var day = $("#${attr}_day").val();
  var year = $("#${attr}_year").val();
  var era = $("#${attr}_era").val();
  $('form')[0].reset();
  $("#${attr}_month").val(month);
  $("#${attr}_day").val(day);
  $("#${attr}_year").val(year);
  $("#${attr}_era").val(era);
  }
  });

  $("#${attr}_reset").click(
  function() {
  $("#${attr}_date_range").slideUp();
  });

  <!-- scripts for auto selecting the year/year_end textboxes  -->
  $("#${attr}_year").click(
  function() {
  $(this).select();
  });
  $("#${attr}_year_end").click(
  function() {
  $(this).select();
  });

  /*
  $("#${attr}_submit").click(
  function() {
  $(".variable_day").remove();
  });  
  */

  <!-- script for validating dates  -->
  $(document).ready(function() {
  $("#${attr}_form").submit(
  function() {
  if (($("#${attr}_era").val() == "ce") && ($("#${attr}_era_end").val() == "bce")) {
  alert("Please review your beginning and ending eras:\nyou cannot go back in time!");
  return false;
  }
  else if (((($("#${attr}_year").val() !== "Year") && ($("#${attr}_year").val() !== "")) && ($("#${attr}_era").val() == "Era")) || ((($("#${attr}_year_end").val() !== "Year") && ($("#${attr}_year_end").val() !== "")) && ($("#${attr}_era_end").val() == "Era"))) {
  alert("Please specify an era for any given years.");
  return false;
  }
  else if (($("#${attr}_year").val() > $("#${attr}_year_end").val()) && ($("#${attr}_era").val() == "ce") && ($("#${attr}_era_end").val() == "ce")) {
  alert("Please review your beginning and ending years:\nyou cannot go back in time!");
  return false;
  }
  else if (($("#${attr}_year").val() < $("#${attr}_year_end").val()) && ($("#${attr}_era").val() == "bce") && ($("#${attr}_era_end").val() == "bce")) {
				       alert("Please review your beginning and ending years:\nyou cannot go back in time!");
				       return false;
				       }
				       /* NEEDS TO SUBMIT TO DATABASE RATHER THAN CHANGE VALUE, SINCE YEAR VALUES ARE LIMITED TO FOUR CHARACTERS IN LENGTH
				       else if (#${attr}_("#${attr}_era").val() == "bce") {
				       $("#${attr}_year").val(0 - $("#${attr}_year").val());
				       return false;
				       }
				       else if (#${attr}_("#${attr}_era_end").val() == "bce") {
				       $("#${attr}_year_end").val(0 - $("#${attr}_year_end").val());
				       return false;
				       }
				       */
				       });
				       });
				       </script>

</%def>


