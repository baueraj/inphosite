<%! import urllib, itertools %>
<%inherit file="/base-tree.html" />
<%namespace name="entity" file="/entity/entity.html" />
<%def name="head()">
<script src="/js/eval.js" type="text/javascript"></script>
<script src="/js/admin.js" type="text/javascript"></script>
</%def>

## Header
<%def name="title()">${parent.title()} - Idea - ${h.titlecase(c.entity.label)}</%def>
<%def name="head_title()">${h.titlecase(c.entity.label)}</%def>
## Sidebar
<%def name="sidebar()">
${parent.sidebar()}
${parent.draw(c.node)}</%def>



<script type="text/javascript">
$(document).ready(function() {
    $("#dialog").dialog({position: [490,380], modal : true, title : 'Multiple Results'});
    $('#tabnav').tab();
});

function removeTab(tab, content) {
    // remove tab
    $(tab).remove();

    // check if active, move to home tab if so
    if ($(content).hasClass('active')) {
        $('#home-tab').addClass('active');
        $('#home').addClass('active');
    }
    // remove tab content
    $(content).remove();
} 

function appendTab(tabNav, id, title, url) {
    // if tab does not exist, append new tab
    if ($('#'+id).length == 0) {
        // append new nav header
        var remove = '<i class="icon-remove remove" onClick="removeTab(\'#'+id+'-tab\', \'#'+id+'\')"></i>';
        $('#'+tabNav).append('<li id="'+id+'-tab"><a href="#'+id+'" data-toggle="tab">'+title+' '+remove+'</a></li>');    
    
        // append temporary loading pane
        var tempPane = '<div class="tab-pane" id="'+id+'">Loading content... <img src="/img/loading.gif" /></div>'
        $('#'+tabNav+'-content').append(tempPane);
    
        // append new tab content
        // make an AJAX call to grab the panel
        $.get(url, function(data){
            $('#'+id).html(data);
        });
    }

    // flip to new tab, regardless of existence
    $('#'+tabNav+' .active').removeClass('active');
    $('#'+id+'-tab').addClass('active');
    $('#'+tabNav+'-content .active').removeClass('active');
    $('#'+id).addClass('active');
}
</script>

<h1>${h.titlecase(c.entity.label)}</h1>
%if c.entity.sep_dir:
<p><a href="http://plato.stanford.edu/entries/${c.entity.sep_dir}/" target="_blank"><img src="/img/sepmanicon.png" /> ${h.titlecase(c.entity.label)}</a> is also an article in the Stanford Encyclopedia of Philosophy.</p>
%endif


## MODAL DIALOG FOR MULTIPLE PLACES
%if c.entity.nodes:
<div id="dialog"> <!-- DIALOG BOX -->
<p>${h.titlecase(c.entity.label)} is classified in \
%if len(c.entity.nodes) > 1:
<em>multiple places</em> in \
%endif
the taxonomy. You may either go to the following context-specific taxonomy pages or <a href="#" onClick="$('#dialog').dialog('close')">stay on this general concept page</a>.</p>

<ul>
<!-- Print out paths to the nodes -->
%for node in c.entity.nodes:
<li>\
<% curParent = node.parent 
parents = []
while curParent:
    parents.insert(0, curParent)
    curParent = curParent.parent
%>
%for parent in parents:
<a class="idea" href="${parent.url()}">${parent.label}</a> -&gt; \
%endfor
<a class="idea" href="${node.url()}">${node.label}</a> \
</li>
%endfor

<li><a href="#" onClick="$('#dialog').dialog('close')">Stay on the current page</a></li>
</ul>

</div> <!-- END DIALOG -->
%endif


<ul class="nav nav-tabs" id="tabnav" data-tabs="tabs">
    <li id="home-tab" class="active"><a href="#home" data-toggle="tab"><i class="icon-home"></i></a></li>
    %if h.auth.is_admin():
    <li id="admin-tab"><a href="#admin" data-toggle="tab"><i class="icon-pencil"></i> Admin </a></li>
    %endif
</ul>

<div class="tab-content" id="tabnav-content">
    <div class="tab-pane active" id="home">
<%
taxonomic = []
parents = [node.parent or c.entity for node in c.entity.nodes]
if c.entity.nodes and parents:
    taxonomic.extend(zip(parents, itertools.repeat(c.entity)))

if c.entity.instance_of:
    taxonomic.extend(zip(c.entity.instance_of, itertools.repeat(c.entity)))
%>

##${entity.printList(taxonomic, 'taxonomy', alt_title='Taxonomic Relations', tax_class='child')}
##${entity.printList(zip(c.entity.links_to[:10], itertools.repeat(c.entity)), 'links', alt_title='Non-taxonomic Links', tax_class='childLink')}
${entity.printList(c.entity.related[:10], 'related', alt_title='Related Terms', statistical=True)}
${entity.printList(c.entity.related_thinkers[:10], 'related_thinkers', statistical=True, evaluation_type='Thinker-Idea')}
${entity.printList(c.entity.hyponyms[:10], 'hyponyms', statistical=True)}
${entity.printList(c.entity.occurrences[:10], 'occurrences', statistical=True)}
    </div>
## If user is authorised, show admin panel
%if h.auth.is_admin():
    <div class="tab-pane" id="admin">
        ${entity.printAdminPanel(["id", "type", "label", "sep_dir", "searchstring", "in-degree", "out-degree", "entropy", "searchpatterns"])}
    </div>
%endif
</div> <!-- tab-content -->
