<%inherit file="/base-tree.html"/>
<%namespace name="entity" file="/entity/entity.html" />

<%def name="label()">
%if c.entity.abbrs and len(c.entity.label) > 50:
${c.entity.abbrs[0]}
%else:
${c.entity.label}
%endif
</%def>

<%def name="title()">Journal - ${label()}</%def>
<%def name="head_title()">${label()}</%def>
<%def name="sidebar()">
${parent.sidebar()}
<br />
${parent.draw()}</%def>

<%def name="head()">
<script src="/js/eval.js" type="text/javascript"></script>
<script src="/js/admin.js" type="text/javascript"></script>
<script src="/js/tabnav.js" type="text/javascript"></script>
<script src="/js/entity.js" type="text/javascript"></script>
</%def>

<script type="text/javascript">
function srch(id) {
    var src  = '/entity/' + id + '/search';
    $.get(src, function(data){
          $("#home").html(data);
        });
}
$(document).ready(function () {
    srch(${c.entity.ID}); 
    $('#tabnav').tab();
});
</script>

%if c.entity.last_accessed < 2419200: 
<div class="alert-message warning">
  <a class="close" href="#">Ã—</a>
    <p><strong>Broken Journal URL!</strong> Journal URL unreachable since ${c.entity.last_accessed_str}</p>
</div>
%endif

<h1>${c.entity.label}</h1>

<ul class="nav nav-tabs" id="tabnav" data-tabs="tabs">
    <li id="home-tab" class="active"><a href="#home" data-toggle="tab"><i class="icon-home"></i></a></li>
    %if h.auth.is_admin():
    <li id="admin-tab"><a href="#admin" data-toggle="tab"><i class="icon-pencil"></i> Admin </a></li>
    %endif
</ul>

<div class="tab-content" id="tabnav-content">
    <div class="tab-pane active" id="home">
    <p>Loading search results ...</p><p><img src='/img/loading.gif' /></p>
    </div>
## If user is authorised, show admin panel
%if h.auth.is_admin():
    <div class="tab-pane" id="admin">
      ${entity.printAdminPanel(['URL', 'language', 'ISSN', 'abbrs', 'queries', 'openAccess', 'student', 'active'])}
    </div>
%endif
</div> <!-- tab-content -->
